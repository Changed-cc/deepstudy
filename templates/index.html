<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>å¤è¯—ç”Ÿæˆç³»ç»Ÿ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Long+Cang&display=swap" rel="stylesheet">

  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .text-shadow {
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
      }
      .poem-style {
        font-family: "Long Cang", cursive;
        font-size: 1.8rem;
        color: #5d4037;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-align: center;
        text-indent: 0 !important;
        margin: 0;
        padding: 0;
      }
      .poem-line {
        text-indent: 0 !important;
        margin: 0;
        padding: 0;
        line-height: 2.5rem;
      }
    }
    /* å¢¨æ°´ç”»å¸ƒ - çº¯è§†è§‰å±‚ */
    #ink-layer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none; /* å…³é”®ï¼šç»ä¸é˜»æŒ¡ä¸‹æ–¹å…ƒç´  */
            z-index: 9999;
        }
  </style>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: "#8b4513",
          },
          fontFamily: {
            gufeng: ['"Long Cang"', 'cursive'],
          }
        },
      },
    };
  </script>
</head>

<body class="min-h-screen bg-neutral font-sans" style="background: url('/static/6.png') no-repeat center center fixed; background-size: cover;">
     <!-- å¢¨æ°´æ•ˆæœå±‚ï¼ˆæ‚¬æµ®åœ¨æœ€ä¸Šå±‚ä½†ä¸é˜»æŒ¡æ“ä½œï¼‰ -->
    <canvas id="ink-layer"></canvas>
  <div class="container mx-auto px-4 py-8 max-w-4xl">
    <header class="text-center mb-10">
      <h1 class="text-[clamp(1.8rem,4vw,3rem)] font-bold text-primary text-shadow mb-3 font-gufeng">
        ğŸ“œä½ çš„å¤ç‰ˆå˜´æ›¿
      </h1>
      <p class="text-gray-600 text-xl max-w-xl mx-auto font-gufeng">
        ä½ å‡ºå­—ï¼Œæˆ‘æ¥è¯—ï¼Œä¸€èµ·ç©è½¬å¤è¯—ç”Ÿæˆçš„å°å¥‡è¿¹
      </p>
    </header>

    <main class="bg-white bg-opacity-90 rounded-xl shadow-lg p-6 md:p-8 mb-10">
      {% if error_msg %}
      <div class="mb-6 p-4 bg-red-100 border-l-4 border-red-500 text-red-700 rounded">
        <p>{{ error_msg }}</p>
      </div>
      {% endif %}

      <form method="post" action="/generate" class="space-y-6">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label for="start_char" class="block text-xl font-medium text-gray-700 mb-2 font-gufeng">
              èµ·å§‹å­—ç¬¦ <span class="text-gray-500 text-base">(è¯·è¾“å…¥ä¸€ä¸ªæ±‰å­—)</span>
            </label>
            <input type="text" id="start_char" name="start_char" maxlength="1"
              class="w-full px-4 py-3 text-gray-700 text-xl border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50"
              value="{{ start_char if start_char else 'èŠ±' }}" required />
          </div>

          <div>
            <label class="block text-xl font-medium text-gray-700 mb-2 font-gufeng">æ¨¡å‹é€‰æ‹©</label>
            <div class="grid grid-cols-2 gap-4">
              <label class="flex items-center p-3 border border-gray-300 rounded-lg cursor-pointer {{ 'bg-primary/10 border-primary' if model_type == 'rnn' else 'hover:bg-gray-50' }}">
                <input type="radio" name="model_type" value="rnn" {{ 'checked' if model_type == 'rnn' or not model_type else '' }} class="mr-2 scale-125" />
                <span class="font-gufeng text-lg">RNN (GRU)</span>
              </label>
              <label class="flex items-center p-3 border border-gray-300 rounded-lg cursor-pointer {{ 'bg-primary/10 border-primary' if model_type == 'transformer' else 'hover:bg-gray-50' }}">
                <input type="radio" name="model_type" value="transformer" {{ 'checked' if model_type == 'transformer' else '' }} class="mr-2 scale-125" />
                <span class="font-gufeng text-lg">Transformer</span>
              </label>
            </div>
          </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label class="block text-xl font-medium text-gray-700 mb-2 font-gufeng">è¯—ä½“é€‰æ‹©</label>
            <div class="grid grid-cols-2 gap-4">
              <label class="flex items-center p-3 border border-gray-300 rounded-lg cursor-pointer {{ 'bg-primary/10 border-primary' if poem_type == 'äº”è¨€' else 'hover:bg-gray-50' }}">
                <input type="radio" name="poem_type" value="äº”è¨€" {{ 'checked' if poem_type == 'äº”è¨€' or not poem_type else '' }} class="mr-2 scale-125" />
                <span class="font-gufeng text-lg">äº”è¨€ç»å¥</span>
              </label>
              <label class="flex items-center p-3 border border-gray-300 rounded-lg cursor-pointer {{ 'bg-primary/10 border-primary' if poem_type == 'ä¸ƒè¨€' else 'hover:bg-gray-50' }}">
                <input type="radio" name="poem_type" value="ä¸ƒè¨€" {{ 'checked' if poem_type == 'ä¸ƒè¨€' else '' }} class="mr-2 scale-125" />
                <span class="font-gufeng text-lg">ä¸ƒè¨€ç»å¥</span>
              </label>
            </div>
          </div>

          <div>
            <label for="temperature" class="block text-xl font-medium text-gray-700 mb-2 font-gufeng">
              åˆ›ä½œé£æ ¼ <span class="text-gray-500 text-base">(å€¼è¶Šå°è¶Šä¸¥è°¨ï¼Œè¶Šå¤§è¶Šè‡ªç”±)</span>
            </label>
            <div class="flex items-center">
              <input type="range" id="temperature" name="temperature" min="0.1" max="2" step="0.1"
                value="{{ temperature if temperature else 0.8 }}"
                class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer" />
              <span id="temp_value" class="ml-2 text-gray-700 text-lg font-gufeng">{{ temperature if temperature else 0.8 }}</span>
            </div>
            <div class="flex justify-between text-base text-gray-500 mt-1 font-gufeng">
              <span>ä¸¥è°¨</span>
              <span>è‡ªç”±</span>
            </div>
          </div>
        </div>

        <div class="text-center">
          <button type="submit"
            class="px-8 py-3 bg-primary text-white rounded-lg hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-primary/50 transition-all duration-300 transform hover:scale-105 font-gufeng text-xl">
            <i class="fa fa-pencil-square-o mr-2"></i>ç”Ÿæˆå¤è¯—
          </button>
        </div>
      </form>

      {% if generated_poem %}
      <div class="mt-10 p-6 bg-amber-50 border border-amber-200 rounded-lg">
        <h2 class="text-xl font-semibold text-center mb-4 font-gufeng">ç”Ÿæˆçš„å¤è¯—</h2>
        <h2 class="text-2xl font-bold text-center mb-2 text-gray-800 font-gufeng">ã€Š{{ generated_title }}ã€‹</h2>
        <pre class="poem-style whitespace-pre-line">{{ generated_poem }}</pre>
        <div class="mt-4 text-center text-sm text-gray-500 font-gufeng">
          <span class="inline-block px-3 py-1 bg-amber-100 rounded-full">
            <i class="fa fa-cogs mr-1"></i> {{ "RNN (LSTM)" if model_type == "rnn" else "Transformer" }} æ¨¡å‹
          </span>
          <span class="inline-block px-3 py-1 bg-amber-100 rounded-full ml-2">
            <i class="fa fa-paint-brush mr-1"></i> {{ poem_type }}
          </span>
        </div>
      </div>
      {% endif %}
    </main>

    <footer class="text-center text-gray-600 py-4 font-gufeng">
      <p>ä½ çš„å¤ç‰ˆå˜´æ›¿ &copy; 2025 | å¤è¯—ç ”ç©¶å‹äººå·¥æ™ºéšœ</p>
    </footer>
  </div>

  <script>
     // ====== çº¯è§†è§‰å¢¨æ°´æ•ˆæœ ======
     const canvas = document.getElementById('ink-layer');
        const ctx = canvas.getContext('2d');
        let particles = [];
        
        // åŒæ­¥ç”»å¸ƒä¸çª—å£å°ºå¯¸
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();
        
        // å¢¨æ°´ç²’å­ç±»
        class InkParticle {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.size = Math.random() * 8 + 2;
                this.color = `rgba(58, 40, 31, ${Math.random() * 0.5 + 0.2})`;
                this.speedX = Math.random() * 3 - 1.5;
                this.speedY = Math.random() * 3 - 1.5;
                this.life = 100;
            }
            
            update() {
                this.x += this.speedX;
                this.y += this.speedY;
                this.life--;
                this.size *= 0.98;
            }
            
            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fillStyle = this.color;
                ctx.fill();
            }
        }
        
        // ç”Ÿæˆç²’å­ï¼ˆè§†è§‰-onlyï¼‰
        function spawnParticles(x, y, count = 5) {
            for (let i = 0; i < count; i++) {
                if (Math.random() > 0.3) { // æ§åˆ¶å¯†åº¦
                    particles.push(new InkParticle(x, y));
                }
            }
        }
        
        // åŠ¨ç”»å¾ªç¯
        function animate() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            for (let i = 0; i < particles.length; i++) {
                particles[i].update();
                particles[i].draw();
                
                if (particles[i].life <= 0) {
                    particles.splice(i, 1);
                    i--;
                }
            }
            
            requestAnimationFrame(animate);
        }
        animate();
        
        // é¼ æ ‡ç§»åŠ¨æ—¶ç”Ÿæˆç²’å­
        document.addEventListener('mousemove', (e) => {
            spawnParticles(e.clientX, e.clientY, 3);
        });
        // æ›´æ–°æ¸©åº¦æ˜¾ç¤º
        document.getElementById('temperature').addEventListener('input', function() {
            document.getElementById('temp_value').textContent = this.value;
        });
    
  </script>
</body>
</html>
