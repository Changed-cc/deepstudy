<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>古诗生成系统</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&display=swap" rel="stylesheet">
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .text-shadow {
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            }
            .bg-paper {
                background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%23d9b88f' fill-opacity='0.1' fill-rule='evenodd'/%3E%3C/svg%3E");
            }
            .poem-style {
                font-family: 'Ma Shan Zheng', cursive;
                font-size: 1.8rem;
                line-height: 2.5rem;
                text-align: center;
                color: #5D4037;
            }
        }
    </style>
</head>
<body class="min-h-screen bg-paper bg-neutral font-sans">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <header class="text-center mb-10">
            <h1 class="text-[clamp(2rem,4vw,3rem)] font-bold text-primary text-shadow mb-3">
                <i class="fa fa-book mr-2"></i>古诗生成系统
            </h1>
            <p class="text-gray-600 max-w-xl mx-auto">
                基于深度学习的古诗创作助手，输入一个汉字，生成五言或七言古诗
            </p>
        </header>

        <main class="bg-white bg-opacity-90 rounded-xl shadow-lg p-6 md:p-8 mb-10">
            {% if error_msg %}
            <div class="mb-6 p-4 bg-red-100 border-l-4 border-red-500 text-red-700 rounded">
                <p>{{ error_msg }}</p>
            </div>
            {% endif %}

            <form method="post" action="/generate" class="space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="start_char" class="block text-lg font-medium text-gray-700 mb-2">
                            起始字符 <span class="text-gray-500 text-sm">(请输入一个汉字)</span>
                        </label>
                        <input type="text" id="start_char" name="start_char" maxlength="1"
                            class="w-full px-4 py-3 text-gray-700 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50"
                            value="{{ start_char | default('春') }}" required>
                    </div>

                    <div>
                        <label class="block text-lg font-medium text-gray-700 mb-2">模型选择</label>
                        <div class="grid grid-cols-2 gap-4">
                            <label class="flex items-center p-3 border border-gray-300 rounded-lg cursor-pointer 
                                {{ 'bg-primary/10 border-primary' if model_type == 'rnn' else 'hover:bg-gray-50' }}">
                                <input type="radio" name="model_type" value="rnn" 
                                    {{ 'checked' if model_type == 'rnn' else '' }} class="mr-2">
                                <span>RNN (LSTM)</span>
                            </label>
                            <label class="flex items-center p-3 border border-gray-300 rounded-lg cursor-pointer 
                                {{ 'bg-primary/10 border-primary' if model_type == 'transformer' else 'hover:bg-gray-50' }}">
                                <input type="radio" name="model_type" value="transformer" 
                                    {{ 'checked' if model_type == 'transformer' else '' }} class="mr-2">
                                <span>Transformer</span>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-lg font-medium text-gray-700 mb-2">诗体选择</label>
                        <div class="grid grid-cols-2 gap-4">
                            <label class="flex items-center p-3 border border-gray-300 rounded-lg cursor-pointer 
                                {{ 'bg-primary/10 border-primary' if poem_type == '五言' else 'hover:bg-gray-50' }}">
                                <input type="radio" name="poem_type" value="五言" 
                                    {{ 'checked' if poem_type == '五言' else '' }} class="mr-2">
                                <span>五言古诗</span>
                            </label>
                            <label class="flex items-center p-3 border border-gray-300 rounded-lg cursor-pointer 
                                {{ 'bg-primary/10 border-primary' if poem_type == '七言' else 'hover:bg-gray-50' }}">
                                <input type="radio" name="poem_type" value="七言" 
                                    {{ 'checked' if poem_type == '七言' else '' }} class="mr-2">
                                <span>七言古诗</span>
                            </label>
                        </div>
                    </div>

                    <div>
                        <label for="temperature" class="block text-lg font-medium text-gray-700 mb-2">
                            创作风格 <span class="text-gray-500 text-sm">(值越小越严谨，越大越自由)</span>
                        </label>
                        <div class="flex items-center">
                            <input type="range" id="temperature" name="temperature" min="0.1" max="2" step="0.1"
                                value="{{ temperature | default(0.8) }}"
                                class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                            <span id="temp_value" class="ml-2 text-gray-700">{{ temperature | default(0.8) }}</span>
                        </div>
                        <div class="flex justify-between text-sm text-gray-500 mt-1">
                            <span>严谨</span>
                            <span>自由</span>
                        </div>
                    </div>
                </div>

                <div class="text-center">
                    <button type="submit" class="px-8 py-3 bg-primary text-white rounded-lg 
                        hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-primary/50 
                        transition-all duration-300 transform hover:scale-105">
                        <i class="fa fa-pencil-square-o mr-2"></i>生成古诗
                    </button>
                </div>
            </form>

            {% if generated_poem %}
            <div class="mt-10 p-6 bg-amber-50 border border-amber-200 rounded-lg">
                <h2 class="text-xl font-semibold text-center mb-4">生成的古诗</h2>
               
                <h2 class="text-2xl font-bold text-center mb-2 text-gray-800">{{ generated_title }}</h2>


                <pre class="poem-style whitespace-pre-line">
                    {{ generated_poem }}
                    </pre>

                <div class="mt-4 text-center text-sm text-gray-500">
                    <span class="inline-block px-3 py-1 bg-amber-100 rounded-full">
                        <i class="fa fa-cogs mr-1"></i> {{ "RNN (LSTM)" if model_type == "rnn" else "Transformer" }} 模型
                    </span>
                    <span class="inline-block px-3 py-1 bg-amber-100 rounded-full ml-2">
                        <i class="fa fa-paint-brush mr-1"></i> {{ poem_type }}
                    </span>
                </div>
            </div>
            {% endif %}

            {% if antithesis_result %}
            <div class="mt-6 text-sm text-gray-700">
                <h3 class="font-semibold">对仗检测结果：</h3>
                <ul class="list-disc list-inside mt-2">
                    {% for pair, ok in antithesis_result %}
                        <li>{{ pair[0] }} | {{ pair[1] }} → {{ '✔ 对仗' if ok else '✘ 不对仗' }}</li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}

        </main>
        <footer class="text-center text-gray-600 py-4">
            <p>古诗生成系统 &copy; 2025 | 基于深度学习的古诗创作助手</p>
        </footer>
    </div>

    <script>
        // 更新温度显示
        document.getElementById('temperature').addEventListener('input', function() {
            document.getElementById('temp_value').textContent = this.value;
        });
    </script>
</body>
</html>